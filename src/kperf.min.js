(function(f){var a,e,j=function(){e.append('<div class="kbuttonbar"><a class="kbtn kprimary" href="'+a.showURL+'">'+a.res.buy+"</a></div>")},k=function(c){var b="",g={},k=0;f.each(c,function(a,b){h=/(.+)T/.exec(b.dateTimeStr)[1]+"-"+b.venue.id;if(!g[h]||g[h].minprice>b.minprice)g[h]=b});for(var h in g)if(g.hasOwnProperty(h)){if(k++>=a.maxEntries)break;var d=g[h],l=d.totalTickets-d.soldTickets,m=/(\d+)-(\d+)-(\d+)/.exec(d.dateTimeStr),i=+(100*(l/d.totalTickets)).toFixed(0),n=0===i?"":20>i?"ksoldout":
40>i?"kscarce":"kplenty",b=b+('<li class="kperformance" title="'+i+"% "+a.res.ticketsAvailable+'"><input type="radio" class="kradio" name="kperformance" value="'+d.id+'">'+a.dateToString(m)+' <b class="kprice">('+d.minPrice+" "+d.currency+')</b><span class="ktickets '+n+'" >'+l+"/"+d.totalTickets+'</span><span class="kvenue"><span class="kvenuename">'+d.venue.name+'</span> <span class="kvenueaddr">'+d.venue.address+"</span></span></li>")}c.length||(b='<li class="kempty kperformance">'+a.res.empty+
"</li>");e.html('<ul class="kperformances">'+b+"</ul>");console.log(c);j();e.append('<a class="kseeother" href="'+a.showURL+'">&raquo; '+a.res.seeOther+"</a>")};f.fn.perfw=function(c){e=this;if(!c.showId)throw Error("options.showId is required");a=f.extend({hostname:"www.koliseo.com",dateToString:function(){return parts[1]+"-"+parts[2]+"-"+parts[3]},maxEntries:5,res:f.extend({ticketsAvailable:"tickets available",seeOther:"see other dates",buy:"Buy tickets",empty:"No performances found"},c?c.res:null)},
c);a.showURL="http://"+a.hostname+"/shows/"+a.showId;e.addClass("kcontainer");f.support.cors?f.ajax({url:a.showURL+"/performances",dataType:"json",type:"GET",success:function(a){k(a)},error:function(a,c){console.error(c);j()}}):j();e.on("click",".kbtn",function(){var b=e.find(".kradio:checked");if(b.length)return window.location.href=a.showURL+"/performance?performance="+b.val(),!1})}})(jQuery);
