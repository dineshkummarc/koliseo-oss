(function(g,k){var i=g.extend({en:{ticketsAvailable:"tickets available",seeOther:"see other dates",buy:"Buy tickets",empty:"No performances found",dateFormat:"Ddd Mm* d*",weekDays:"Sunday Monday Tuesday Wednesday Thursday Friday Saturday",months:"January February March April May June July August September October November December"},es:{ticketsAvailable:"de entradas disponibles",seeOther:"ver otras fechas",buy:"Comprar",empty:"No hay actuaciones disponibles",dateFormat:"Ddd d* de Mm*",weekDays:"Domingo Lunes Martes Mi\u00e9rcoles Jueves Viernes S\u00e1bado",
months:"Enero Febrero Marzo Abril Mayo Junio Julio Agosto Septiembre Octubre Noviembre Diciembre"}},k.Koliseo?k.Koliseo.resources:void 0);g.fn.kperf=function(h){var b,f,c=this,k=function(a,b){var d=f.months.split(" ")[a.getMonth()],c=f.weekDays.split(" ")[a.getDay()],e=function(a){a=""+a;return"00".substring(0,2-a.length)+a};return b.replace(/yyyy/g,a.getFullYear()).replace(/yy/g,(""+a.getFullYear()).substr(2,2)).replace(/MMM/g,d.substr(0,3).toUpperCase()).replace(/Mmm/g,d.substr(0,3)).replace(/MM\*/g,
d.toUpperCase()).replace(/Mm\*/g,d).replace(/mm/g,e(a.getMonth()+1)).replace(/DDD/g,c.substr(0,3).toUpperCase()).replace(/Ddd/g,c.substr(0,3)).replace(/DD\*/g,c.toUpperCase()).replace(/Dd\*/g,c).replace(/dd/g,e(a.getDate())).replace(/d\*/g,a.getDate())},n=function(){c.append('<div class="kbuttonbar"><a class="kbtn kprimary" href="'+b.showURL+'">'+f.buy+"</a></div>")},p=function(a){var j="",d={},h=0;g.each(a,function(a,b){e=/(.+)T/.exec(b.dateTimeStr)[1]+"-"+b.venue.id;if(!d[e]||d[e].minprice>b.minprice)d[e]=
b});for(var e in d)if(d.hasOwnProperty(e)){if(h++>=b.maxEntries)break;var a=d[e],i=a.totalTickets-a.soldTickets,o=/(\d+)-(\d+)-(\d+)/.exec(a.dateTimeStr),l=+(100*(i/a.totalTickets)).toFixed(0),m=0===l?"":20>l?"ksoldout":40>l?"kscarce":"kplenty",j=j+('<li class="kperformance" title="'+l+"% "+f.ticketsAvailable+'"><input type="radio" class="kradio" name="kperformance" value="'+a.id+'">'+k(new Date(o[1],o[2],o[3]),b.dateFormat)+' <b class="kprice">('+a.minPrice+" "+a.currency+')</b><span class="ktickets '+
m+'" >'+i+"/"+a.totalTickets+'</span><span class="kvenue"><span class="kvenuename">'+a.venue.name+'</span> <span class="kvenueaddr">'+a.venue.address+"</span></span></li>")}j=j||'<li class="kempty kperformance">'+f.empty+"</li>";c.append('<ul class="kperformances">'+j+"</ul>");n();c.append('<a class="kseeother" href="'+b.showURL+'">&raquo; '+f.seeOther+"</a>")};if(this.length){b=g.extend({hostname:"www.koliseo.com",maxEntries:5},this.data(),h);if(!b.showId)throw Error("options.showId is required");
b.showURL="http://"+b.hostname+"/shows/"+b.showId;h=b.locale;if(!h){var m=/([^\-]{2})-.+/.exec(navigator.language||navigator.userLanguage||"");m&&(h=m[1])}f=b.res||i[h]||i.en;b.dateFormat=b.dateFormat||f.dateFormat;c.addClass("kcontainer").html("");g.support.cors?(c.addClass("kloading"),g.ajax({url:b.showURL+"/performances",dataType:"json",type:"GET",success:function(a){c.removeClass("kloading");p(a)},error:function(a,b){c.removeClass("kloading");console.error(b);n()}})):n();c.on("click",".kbtn",
function(){var a=c.find(".kradio:checked");if(a.length){window.location.href=b.showURL+"/performance?performance="+a.val();return false}})}};g(".kcontainer").kperf()})(jQuery,window);
