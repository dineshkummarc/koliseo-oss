(function(c,k){var l=c.extend({en:{ticketsAvailable:"tickets available",seeOther:"see other dates",buy:"Buy tickets",empty:"No performances found",dateFormat:"Ddd Mm* d*",weekDays:"Sunday Monday Tuesday Wednesday Thursday Friday Saturday",months:"January February March April May June July August September October November December"},es:{ticketsAvailable:"de entradas disponibles",seeOther:"ver otras fechas",buy:"Comprar",empty:"No hay actuaciones disponibles",dateFormat:"Ddd d* de Mm*",weekDays:"Domingo Lunes Martes Mi\u00e9rcoles Jueves Viernes S\u00e1bado",
months:"Enero Febrero Marzo Abril Mayo Junio Julio Agosto Septiembre Octubre Noviembre Diciembre"}},k.Koliseo?k.Koliseo.resources:void 0);c.fn.kperf=function(g){var b,f,d=this,k=function(a,b){var e=f.months.split(" ")[a.getMonth()],c=f.weekDays.split(" ")[a.getDay()],d=function(a){a=""+a;return"00".substring(0,2-a.length)+a};return b.replace(/yyyy/g,a.getFullYear()).replace(/yy/g,(""+a.getFullYear()).substr(2,2)).replace(/MMM/g,e.substr(0,3).toUpperCase()).replace(/Mmm/g,e.substr(0,3)).replace(/MM\*/g,
e.toUpperCase()).replace(/Mm\*/g,e).replace(/mm/g,d(a.getMonth()+1)).replace(/DDD/g,c.substr(0,3).toUpperCase()).replace(/Ddd/g,c.substr(0,3)).replace(/DD\*/g,c.toUpperCase()).replace(/Dd\*/g,c).replace(/dd/g,d(a.getDate())).replace(/d\*/g,a.getDate())},n=function(){d.append('<div class="kbuttonbar"><a class="kbtn kprimary" href="'+b.showURL+'">'+f.buy+"</a></div>")},p=function(a){var j="",e={},g=0;c.each(a,function(a,b){h=/(.+)T/.exec(b.dateTimeStr)[1]+"-"+b.venue.id;if(!e[h]||e[h].minprice>b.minprice)e[h]=
b});for(var h in e)if(e.hasOwnProperty(h)){if(g++>=b.maxEntries)break;var a=e[h],i=a.totalTickets-a.soldTickets,o=/(\d+)-(\d+)-(\d+)/.exec(a.dateTimeStr),m=+(100*(i/a.totalTickets)).toFixed(0),l=0===m?"":20>m?"ksoldout":40>m?"kscarce":"kplenty",j=j+('<li class="kperformance" title="'+m+"% "+f.ticketsAvailable+'"><input type="radio" class="kradio" name="kperformance" value="'+a.id+'">'+k(new Date(o[1],o[2],o[3]),b.dateFormat)+' <b class="kprice">('+a.minPrice+" "+a.currency+')</b><span class="ktickets '+
l+'" >'+i+"/"+a.totalTickets+'</span><span class="kvenue"><span class="kvenuename">'+a.venue.name+'</span> <span class="kvenueaddr">'+a.venue.address+"</span></span></li>")}j=j||'<li class="kempty kperformance">'+f.empty+"</li>";d.append('<ul class="kperformances">'+j+"</ul>");n();d.append('<a class="kseeother" href="'+b.showURL+'">&raquo; '+f.seeOther+"</a>")},i=function(){var a=c('script[src*="/kperf"]').attr("src");a&&(a=a.replace(".js",".css"),c('link[href="'+a+'"]').length||c("head").append('<link rel="stylesheet" href="'+
a+'">'))};if(this.length){b=c.extend({hostname:"www.koliseo.com",maxEntries:5,insertCss:!0},this.data(),g);if(!b.showId)throw Error("options.showId is required");b.showURL="http://"+b.hostname+"/shows/"+b.showId;b.insertCss&&i();g=b.locale;g||(i=/([^\-]{2})-.+/.exec(navigator.language||navigator.userLanguage||""))&&(g=i[1]);f=b.res||l[g]||l.en;b.dateFormat=b.dateFormat||f.dateFormat;d.addClass("kcontainer").html("");c.support.cors?(d.addClass("kloading"),c.ajax({url:b.showURL+"/performances",dataType:"json",
type:"GET",success:function(a){d.removeClass("kloading");p(a)},error:function(a,b){d.removeClass("kloading");console.error(b);n()}})):n();d.on("click",".kbtn",function(){var a=d.find(".kradio:checked");if(a.length){window.location.href=b.showURL+"/performance?performance="+a.val();return false}})}};c(".kcontainer").kperf()})(jQuery,window);
